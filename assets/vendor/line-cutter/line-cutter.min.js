!function($){var lineHeight=0,crrntLine=0,crrntWord=0,crrntLineOffset=0,needSuffix=0;function splitToLines(words,lineNumber){for(var arrLines=[],i=0;i<words.length;i++,crrntWord++)0===i&&(arrLines[0]=[],0!==words.eq(i).position().top&&(crrntLineOffset=words.eq(i).position().top)),checkOffset=words.eq(i).position().top,checkOffset>crrntLineOffset&&(crrntLineOffset=checkOffset,crrntLine++,crrntWord=0,arrLines[crrntLine]=[]),arrLines[crrntLine][crrntWord]=words.eq(i);return arrLines[lineNumber]&&(needSuffix=1),arrLines}function wrapWords(words){arrWords=[];for(var i=words.length;i--;){var crrntWord=words[i].trim();arrWords[i]="<span>"+crrntWord+"</span> "}return arrWords}function wrapLines(lines,linesNumber){linesString="";for(var i=0;i<linesNumber;i++){var line="";if(!lines[i])break;lineLength=lines[i].length;for(var j=0;j<lineLength;j++)line+=lines[i][j].text()+" ";linesString+=line+"\n"}return linesString.trim()}function addSuffix(str,suffix){return needSuffix&&(suffixLen=suffix.length,str=str.slice(0,-suffixLen),str=(str+=suffix).replace(" "+suffix,suffix),needSuffix=0),str}$.fn.line=function(lineNumber,endStr){var targets=this;this.each((function(i,e){var element=$(e),txt=element.text(),editedLines="";lineNumber=lineNumber||2,endStr=endStr||"...","static"===element.css("position")&&element.css("position","relative"),element.data("initial-content")||element.data("initial-content",txt),element.data("initial-content").length>=txt.length&&(txt=element.data("initial-content")),element.html(wrapWords(txt.split(" ")).join("")),editedLines=wrapLines(splitToLines(element.find("span"),lineNumber),lineNumber),element.html(addSuffix(editedLines,endStr)),console.log("Finish!"),lineHeight=0,crrntLine=0,crrntWord=0,crrntLineOffset=0}))}}(jQuery);